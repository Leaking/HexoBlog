---
title: 理解HTTPS（编写中，，，）
date: 2016-11-28 20:58:40
toc: true
tags: Https
---

这个周末重新梳理了一下关于HTTPS的相关知识，突然发现有些概念之前确实是模棱两可的状态，这里写下我对HTTPS最新的理解。

首先，先列出和HTTPS相关的知识点

+ SSL/TLS
+ 对称加密、非对称加密、公钥私钥
+ 数字摘要，数字签名
+ 数字证书

另外，列出HTTPS的步骤

+ 握手阶段（建立安全连接，非对称加密、数字摘要、数字签名、数字证书都是在这个阶段出现）
+ 通信阶段（这个阶段进行简单的对称加密通信）

从上面的梳理不难看出，我们接下来讲到的很多概念，都是出现在握手阶段。接下来让我们从基础开始。


# 一、HTTP HTTPS SSL/TLS的概念

只是基于HTTP协议的网络通信，信息是明文传输的，HTTP协议结合SSL/TLS协议后，就能实现加密的网络通信，这种通信协议也就是HTTPS协议。HTTPS协议的加密工作就是由SSL/TLS协议完成。

SSL/TLS层是介于应用层（HTTP就在这一层）和TCP层的传输安全层，下图是来自《HTTP权威指南》一书的截图

![SSL/TLS](/images/https_ssl.png)

SSL的全称是：Secure Sockets Layer；TLS的全称是：Transport Layer Security

那么SSL和TLS有什么关系呢？很简单，TLS是SSL的升级版本。最开始NetScape公司设计了SSL协议，后来互联网标准化组织ISOC接替NetScape公司，发布了SSL的升级版TLS。

综上所述，我们可以知道，HTTPS相比于HTTP，就是多了SSL/TLS这一层，所以我们接下来讨论的HTTPS的特点，其实就是SSL/TLS的特点。

# 二、关于加密的基础

关于加密，首先得知道一个概念，密钥是加密算法的一个参数，密钥就像调用一个函数时输入的参数。而HTTPS中使用的加密算法基本公开的，所以加密的安全性取决于你对密钥的管理和保护。

HTTPS中涉及到的加密算法，包括以下三种。

+ 对称加密：DES，Triple-DES，RC2，RC4等
+ 非对称加密：RSA等
+ 不可逆加密：SHA-1，MD5等

接下来一一介绍着三种算法的特点以及应用场景

## 对称加密

密钥成对出现，而且两个密钥相同，两个密钥之间可以相互加密解密，对称加密的缺点在于维护密钥很麻烦，如果N个节点间相互通信，则每个节点需要给其他（N-1）个节点颁发一个唯一的密钥，所以一共需要产生N*(N-1)个密钥，管理成本很高。而接下来讲到的非对称加密对密钥的管理就容易多了。

另外，由于加密解密的密钥相同，所以，如果A需要和B、C两个人通信，则A需要给B和C颁发不同的密钥，否则B和C之间可以解密你发给他们任何一个人的信息。所以对称加密是一对一的，而下面即将讲到的非对称加密则是一对多的。

对称加密有一个优点，它的计算速度相比非对称加密更快。

## 非对称加密

密钥成对出现，而且两个密钥不同，一个叫公钥，一个叫私钥，私钥一般存储于服务器，而公钥则是公开的，每个人都可以从服务器获取一把公钥。

上面我们讲到对称加密的两个密钥可以相互加解密，那么非对称加密的公钥和私钥呢？它们可以相互加解密吗？

答案是不可以，一般公钥用于加密（在客户端完成），私钥用于解密（在服务器完成），后面我们会讲到HTTPS中非对称加密的使用场景。

非对称加密管理密钥很简单，服务器持有一把私钥，所有客户端可以从服务器请求获得一把公钥，大家获得的公钥都是相同的，公钥加密的信息只能由私钥解密，所以，虽然所有客户端的公钥相同，也不同担心他们解密其他人的信息。很明显，相比于对称加密的一对一关系，非对称加密是一对多的关系。

非对称加密有一个缺点，就是相比于对称加密，速度比较慢。

从上面的介绍，我们知道对称加密和非对称加密各有优点缺点，对称加密优点在于速度快，非对称加密优点在于管理密钥更方便，所以HTTPS扬长避短，在不同阶段使用这两种算法。HTTPS开始建立连接时，进行几次握手，这个过程使用非对称加密，这个过程完成后，客户端和服务器就会持有一个相同的密钥，接下来使用更快的对称加密进行通信。

好，回头看看文章开头讲到的HTTPS的两个阶段：握手阶段（建立通信阶段）和通信阶段。其实HTTPS的很多概念，诸如数字摘要，数字签名，数字证书，都是在握手阶段出现的，通信阶段只是简单的对称加密而已。

# 三、数字摘要，数字签名、数字证书

握手阶段，服务器拥有公钥和私钥，各个客户端可以从服务器申请获得公钥，握手阶段的最终目的是让服务器和客户端拥有一个相同的密钥，用于通信阶段的对称加密。

所有，握手阶段，主要需要关注以下几个问题

+ 信息在发送过程是否被篡改
+ 通信的对象是否是第三方假冒的（中间人攻击）
+ 最终生成的对称密钥安全可靠

HTTPS的握手阶段就是围绕以上风险进行设计的。

我们先来介绍数字摘要和数字签名在握手阶段是如何应用的。数字摘要是报文调用诸如HASH、MD5等不可逆算法产生的摘要信息，而数字签名是数字摘要加密后的结果。数字摘要和数字签名主要用于检验信息是否被篡改。

数字摘要和数字签名的使用场景如下：

+ 客户端获取并验证了来自服务器的公钥
+ 服务器准备好一段报文（明文，未加密），并从报文中生成数字摘要，使用私钥对数字摘要加密生成数字签名，带在报文末尾
+ 服务器发送带有数字签名的报文给客户端
+ 客户端收到报文，取下数字签名，并使用公钥对数字签名解密，









，，
